#/bin/bash

clear

# Colors
RESET="\e[0m"
BOLD="\e[1m"
DIM="\e[2m"
UNDERLINE="\e[4m"
CYAN="\e[96m"
BLUE="\e[94m"
PURPLE="\e[95m"
GREEN="\e[92m"
YELLOW="\e[93m"
RED="\e[91m"
WHITE="\e[97m"
NEON_GREEN="\e[38;5;82m"
NEON_PURPLE="\e[38;5;165m"
DANGER="\e[38;5;75m"
GLOW="\e[38;5;51m"
DANGER="\e[38;5;196m"

welcome_banner() {
    clear
    echo -e "${DANGER}"
    cat << "EOF"
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— 
â•šâ•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â•šâ•â•â–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—
   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ–ˆâ•”â• â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•
   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ–ˆâ•”â•  â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—
   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘
   â•šâ•â•   â•šâ•â•  â•šâ•â•â•šâ•â•â•šâ•â•â•â•â•â•â•â•šâ•â•â•â•â•â•â•â•šâ•â•  â•šâ•â•
EOF

# Utility Functions
progress() { echo -e "${NEON_GREEN}${BOLD}â¤ $1${RESET}"; }
success() { echo -e "${GREEN}${BOLD}âœ“ $1${RESET}"; }
warning() { echo -e "${YELLOW}${BOLD}! $1${RESET}"; }
error() { echo -e "${RED}${BOLD}âœ˜ $1${RESET}"; }
print_box_header() {
    local text="$1"
    local color="${2:-$NEON_PURPLE}"
    echo -e "${color}${BOLD}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${RESET}"
    echo -e "${color}${BOLD}â•‘${RESET} ${WHITE}${BOLD}$text$(printf '%*s' $((58 - ${#text})) '') ${color}${BOLD}â•‘${RESET}"
    echo -e "${color}${BOLD}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${RESET}\n"
}
print_menu_option() {
    local num="$1"
    local text="$2"
    echo -e "${DANGER} â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”${RESET}"
    echo -e "${DANGER} â”‚${RESET} ${WHITE}${BOLD}[${NEON_GREEN}${num}${WHITE}]${RESET} ${CYAN}${text}$(printf '%*s' $((48 - ${#text} - 3)) '') ${DANGER}â”‚${RESET}"
    echo -e "${DANGER} â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜${RESET}"
}
# Remote Script Runner
run_remote_script() {
    local url="$1"
    local name="$2"
    clear
    echo -e "${NEON_PURPLE}"
    cat << "EOF"
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— 
â•šâ•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â•šâ•â•â–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—
   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ–ˆâ•”â• â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•
   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ–ˆâ•”â•  â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—
   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘
   â•šâ•â•   â•šâ•â•  â•šâ•â•â•šâ•â•â•šâ•â•â•â•â•â•â•â•šâ•â•â•â•â•â•â•â•šâ•â•  â•šâ•â•
                             
EOF
    print_box_header "$name" $NEON_PURPLE
    progress "Downloading and executing remote script..."
    local temp_script=$(mktemp)
    if curl -fsSL "$url" -o "$temp_script"; then
        chmod +x "$temp_script"
        bash "$temp_script"
        rm -f "$temp_script"
        success "$name completed!"
    else
        error "Failed to download script from $url"
    fi
    echo -e "\n${DANGER}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${RESET}"
    read -p $'\e[93mPress Enter to return to menu...\e[0m' -r
}
# Main Menu
show_menu() {
    clear
    echo -e "${DANGER}"
    cat << "EOF"
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— 
â•šâ•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â•šâ•â•â–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—
   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ–ˆâ•”â• â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•
   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ–ˆâ•”â•  â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—
   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘
   â•šâ•â•   â•šâ•â•  â•šâ•â•â•šâ•â•â•šâ•â•â•â•â•â•â•â•šâ•â•â•â•â•â•â•â•šâ•â•  â•šâ•â•
                                                           
                                              
EOF
    echo -e "${NEON_PURPLE}${BOLD} PTERODACTYL HOSTING MANAGER${RESET}\n"
    print_box_header "CONTROL PANEL" $NEON_PURPLE
    print_menu_option "1" "Skyport Panel Installation"
    print_menu_option "2" "HvmPanel Installation"
    print_menu_option "3" "Tailscale Installation"
    print_menu_option "4" "Cloudflare Setup"
    print_menu_option "5" "Ptero Panel Installation"
    print_menu_option "6" "Ptero Wings Installation"
    print_menu_option "7" "Panel Update"
    print_menu_option "8" "Uninstall Tools"
    print_menu_option "9" "Blueprint Setup"
    print_menu_option "10" "Change Theme"
    print_menu_option "11" "Minecraft Player Manager"
    print_menu_option "12" "Jexactyl Installation"
    print_menu_option "0" "Exit Manager"
    echo -e "\n${DANGER}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${RESET}"
    read -p $'\e[93m\e[1m Select option [0-10]: \e[0m' choice
    echo
}
# Main Loop
welcome_banner
# Main Loop
while true; do
    show_menu
    case $choice in
        1) run_remote_script "https://raw.githubusercontent.com/Trizer540/Skyport/refs/heads/main/panel" "SKYPORT PANEL INSTALLATION" ;;
        2) run_remote_script "https://raw.githubusercontent.com/Trizer540/HvmPanel/refs/heads/main/panel" "HVMPANEL INSTALLATION" ;;
        3) run_remote_script "https://raw.githubusercontent.com/Trizer540/Cloudflare/refs/heads/main/tailscale" "TAILSCALE INSTALLATION" ;;
        4) run_remote_script "https://raw.githubusercontent.com/Trizer540/Cloudflare/refs/heads/main/cloudflare" "CLOUDFLARE SETUP" ;;
        5) run_remote_script "https://raw.githubusercontent.com/mahimxyzz/Vps/refs/heads/main/cd/panel2.sh" "PTERO PANEL INSTALLATION" ;;
        6) run_remote_script "https://raw.githubusercontent.com/mahimxyzz/Vps/refs/heads/main/cd/wing2.sh" "PTERO WINGS INSTALLATION" ;;
        7) run_remote_script "https://raw.githubusercontent.com/mahimxyzz/Vps/refs/heads/main/cd/update2.sh" "PANEL UPDATE" ;;
        8) run_remote_script "https://raw.githubusercontent.com/mahimxyzz/Vps/refs/heads/main/cd/uninstall2.sh" "UNINSTALL TOOLS" ;;
        9) run_remote_script "https://raw.githubusercontent.com/mahimxyzz/Vps/refs/heads/main/cd/Blueprint2.sh" "BLUEPRINT SETUP" ;;
        10) run_remote_script "https://raw.githubusercontent.com/mahimxyzz/Vps/refs/heads/main/cd/th2.sh" "THEME CHANGER" ;;
11)
    clear
    print_box_header "MINECRAFT PLAYER MANAGER" $NEON_PURPLE
    progress "Installing Minecraft extensions..."
    cd /var/www/pterodactyl || { error "Panel directory not found!"; read -p "Press Enter..."; continue; }
    
    wget -q https://github.com/mahimxyzz/Vps/raw/main/minecraftplayermanager.blueprint
    wget -q https://github.com/mahimxyzz/Vps/raw/main/mcplugins.blueprint
    wget -q https://github.com/mahimxyzz/Vps/raw/main/huxregister.blueprint
    
    blueprint -i mcplugins.blueprint && success "MC Plugins installed"
    blueprint -i minecraftplayermanager.blueprint && success "Player Manager installed"
    blueprint -i huxregister.blueprint && success "huxregister installed"
    
    read -p $'\e[93mPress Enter to continue...\e[0m' -r
    ;;
0)
            exit
            ;;
12)
            clear
            print_box_header "JEXACTYL FULL PANEL MIGRATION" $NEON_PURPLE
            
            echo -e "${BOLD}${RED}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${RESET}"
            echo -e "${BOLD}${RED}â•‘                     CRITICAL WARNING                         â•‘${RESET}"
            echo -e "${BOLD}${RED}â•‘  This will COMPLETELY OVERWRITE your Pterodactyl panel       â•‘${RESET}"
            echo -e "${BOLD}${RED}â•‘  with the full Jexactyl panel (billing, ticketing, etc.).    â•‘${RESET}"
            echo -e "${BOLD}${RED}â•‘                                                              â•‘${RESET}"
            echo -e "${BOLD}${RED}â•‘  THIS ACTION IS NOT REVERSIBLE WITHOUT A BACKUP!             â•‘${RESET}"
            echo -e "${BOLD}${RED}â•‘  BACKUP YOUR FILES AND DATABASE BEFORE CONTINUING!           â•‘${RESET}"
            echo -e "${BOLD}${RED}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${RESET}"
            echo
            
            # Require user to type exactly "yes" to confirm
            while true; do
                echo -e "${YELLOW}${BOLD}To continue the migration, type ${UNDERLINE}yes${RESET}${YELLOW}${BOLD} exactly and press Enter:${RESET}"
                read -r confirmation
                if [[ "$confirmation" == "yes" ]]; then
                    break
                else
                    echo -e "${RED}${BOLD}âœ˜ Incorrect confirmation. You typed: '${confirmation:-<empty>}'${RESET}"
                    echo -e "${YELLOW}Migration cancelled. Returning to menu...${RESET}"
                    read -p $'\e[93mPress Enter to continue...\e[0m' -r
                    continue 2  # Return to main menu
                fi
            done
            
            progress "Navigating to panel directory..."
            cd /var/www/pterodactyl || { 
                echo -e "${RED}${BOLD}âœ˜ Panel directory not found! (/var/www/pterodactyl)${RESET}"
                read -p $'\e[93mPress Enter to continue...\e[0m' -r
                continue
            }
            
            progress "Placing panel in maintenance mode..."
            php artisan down || {
                echo -e "${RED}${BOLD}âœ˜ Failed to enable maintenance mode.${RESET}"
                read -p $'\e[93mPress Enter to continue...\e[0m' -r
                continue
            }
            
            progress "Downloading latest stable Jexactyl release (v3.7.4)..."
            curl -L -o panel.tar.gz https://github.com/jexactyl/jexactyl/releases/download/v3.7.4/panel.tar.gz || {
                echo -e "${RED}${BOLD}âœ˜ Download failed. Check internet or GitHub status.${RESET}"
                php artisan up
                read -p $'\e[93mPress Enter to continue...\e[0m' -r
                continue
            }
            
            progress "Extracting and replacing files..."
            tar -xzvf panel.tar.gz >/dev/null && rm -f panel.tar.gz || {
                echo -e "${RED}${BOLD}âœ˜ Failed to extract archive.${RESET}"
                rm -f panel.tar.gz 2>/dev/null
                php artisan up
                read -p $'\e[93mPress Enter to continue...\e[0m' -r
                continue
            }
            
            progress "Setting storage and cache permissions..."
            chmod -R 755 storage/* bootstrap/cache
            
            progress "Updating Composer dependencies..."
            composer require asbiin/laravel-webauthn --no-interaction 2>/dev/null || echo -e "${YELLOW}â„¹ WebAuthn package skipped (usually not needed).${RESET}"
            composer install --no-dev --optimize-autoloader --no-interaction || {
                echo -e "${RED}${BOLD}âœ˜ Composer installation failed.${RESET}"
                php artisan up
                read -p $'\e[93mPress Enter to continue...\e[0m' -r
                continue
            }
            
            progress "Clearing application caches..."
            php artisan optimize:clear
            
            progress "Running database migrations & seeding..."
            php artisan migrate --seed --force || {
                echo -e "${RED}${BOLD}âœ˜ Database migration failed! Restore backup ASAP!${RESET}"
                php artisan up
                read -p $'\e[93mPress Enter to continue...\e[0m' -r
                continue
            }
            
            progress "Fixing webserver ownership (www-data)..."
            chown -R www-data:www-data /var/www/pterodactyl/* 2>/dev/null || echo -e "${YELLOW}â„¹ Ownership fix skipped (manual chown if needed).${RESET}"
            
            progress "Restarting queue workers..."
            php artisan queue:restart
            
            progress "Bringing panel back online..."
            php artisan up
            
            echo
            echo -e "${NEON_GREEN}${BOLD}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${RESET}"
            echo -e "${NEON_GREEN}${BOLD}â•‘               JEXACTYL MIGRATION SUCCESSFUL!                  â•‘${RESET}"
            echo -e "${NEON_GREEN}${BOLD}â•‘  Your panel is now running Jexactyl v3.7.4 (latest stable)   â•‘${RESET}"
            echo -e "${NEON_GREEN}${BOLD}â•‘  Enjoy billing, ticketing, improved UI & many more features! â•‘${RESET}"
            echo -e "${NEON_GREEN}${BOLD}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${RESET}"
            echo
            echo -e "${CYAN}${BOLD}âœ Hard refresh browser (Ctrl+Shift+R) to load the new panel.${RESET}"
            echo -e "${WHITE}${DIM}Welcome to Jexactyl! ğŸ‰${RESET}"
            
            read -p $'\e[93mPress Enter to continue...\e[0m' -r
            ;;
    esac
done
